---
title: "Contrast Algorithms for Linear Models"
author: "Craig A. Wendorf"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
    collapse: true
    theme: cerulean
    highlight: default
    keep_md: TRUE
vignette: >
  %\VignetteIndexEntry{Using Contrast Codes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r,include=FALSE}
#suppress the warnings and other messages from showing in the knitted file.
knitr::opts_chunk$set(fig.width=7, fig.height=5,fig.path='figures/',echo=TRUE,warning=FALSE,message=FALSE)
```

```{r,include=FALSE}
library(CALM)
```

## Using Contrast Codes

### Overview

`CALM` includes a complete set of commonly used coding schemes. These include extensions of the built-in contrast specifications in Base R and a modification of Venables's `codingMatrices` package. They can be used directly in linear model specifications. It is also possible to develop custom codes to test specific hypotheses.

### The Basic Example

For the sake of example, this site uses the following data. For reference, the group means are displayed.

```{r}
mtcars
mtcars$cyl = factor(mtcars$cyl) 
tapply(mtcars$mpg,mtcars$cyl,mean)
```

### Available Contrast Codes

#### Example: Treatment (First) Contrasts

```{r}
contrasts(mtcars$cyl) = treatment.first(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the first group. Parameters represent the difference between each group and the first group.

#### Example: Treatment (Last) Contrasts

```{r}
contrasts(mtcars$cyl) = treatment.last(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the last group. Parameters represent the difference between each group and the last group.

#### Example: Control (First) Contrasts

```{r}
contrasts(mtcars$cyl) = control.first(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the first group.

#### Example: Control (Last) Contrasts

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the last group.

```{r}
contrasts(mtcars$cyl) = control.last(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

#### Example: Deviation (First) Contrasts

```{r}
contrasts(mtcars$cyl) = deviation.first(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the grand mean. The first group is not compared. 

#### Example: Deviation (Last) Contrasts

```{r}
contrasts(mtcars$cyl) = deviation.last(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the grand mean. The last group is not compared.

#### Example: Helmert (Forward) Contrasts

```{r}
contrasts(mtcars$cyl) = helmert.forward(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the mean of the subsequent groups. 

#### Example: Helmert (Reverse) Contrasts

```{r}
contrasts(mtcars$cyl) = helmert.reverse(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the mean of the previous groups.

#### Example: Repeated (Forward) Contrasts

```{r}
contrasts(mtcars$cyl) = repeated.forward(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the first group. Parameters represent the difference between each group and the subsequent group.

#### Example: Repeated (Reverse) Contrasts

```{r}
contrasts(mtcars$cyl) = repeated.reverse(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the first group. Parameters represent the difference between each group and the previous group.

#### Example: Difference (Forward) Contrasts

```{r}
contrasts(mtcars$cyl) = difference.forward(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the subsequent group. 

#### Example: Difference (Reverse) Contrasts

```{r}
contrasts(mtcars$cyl) = difference.reverse(3)
summary(lm(mpg~cyl, mtcars))$coefficients
```

The intercept is equivalent to the mean of the group means. Parameters represent the difference between each group and the previous group. 

### Custom Contrast Codes

#### Example: Orthogonal Contrasts

```{r}
GM <- c(1/3,1/3,1/3)
H1 <- c(1,-1/2,-1/2)
H2 <- c(0,1,-1)
ex_custom.orthogonal <- rbind(GM,H1,H2)
custom.orthogonal = calm.encode(ex_custom.orthogonal)
custom.orthogonal
```

```{r}
contrasts(mtcars$cyl) = custom.orthogonal[,-1]
summary(lm(mpg~cyl, mtcars))$coefficients
```

In this custom example, the intercept is equivalent to the mean of the group means. The first parameter represents the difference between the first group and mean of the subsequent groups. The second parameter represents the difference between the second and third groups.

#### Example: Nonorthogonal Contrasts

```{r}
GM <- c(1,0,0)
H1 <- c(1,-1/2,-1/2)
H2 <- c(1,-1,0)
ex_custom.nonorthogonal <- rbind(GM,H1,H2)
custom.nonorthogonal = calm.encode(ex_custom.nonorthogonal)
custom.nonorthogonal
```

```{r}
contrasts(mtcars$cyl) = custom.nonorthogonal[,-1]
summary(lm(mpg~cyl, mtcars))$coefficients
```

In this custom example, the intercept is equivalent to the mean of the first group. The first parameter represents the difference between the first group and mean of the subsequent groups. The second parameter represents the difference between the first and second groups.
